<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>music21.test.testRunner &mdash; music21 Documentation</title>
    
    <link rel="stylesheet" href="../_static/m21.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <link rel="top" title="music21 Documentation" href="../index.html" />
    <link rel="up" title="Module Reference" href="index.html" />
    <link rel="next" title="music21.test.testSingleCoreAll" href="moduleTestTestSingleCoreAll.html" />
    <link rel="prev" title="music21.test.testLint" href="moduleTestTestLint.html" /><link href='http://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:300italic,400italic,700italic,400,300,700' rel='stylesheet' type='text/css'>
<script src='http://artusi.xyz/music21j/ext/require/require.js'></script>
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="moduleTestTestSingleCoreAll.html" title="music21.test.testSingleCoreAll"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="moduleTestTestLint.html" title="music21.test.testLint"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">music21</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Module Reference</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="moduleTestTestLint.html"
                        title="previous chapter">music21.test.testLint</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="moduleTestTestSingleCoreAll.html"
                        title="next chapter">music21.test.testSingleCoreAll</a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">music21.test.testRunner</a><ul>
<li><a class="reference internal" href="#functions">Functions</a></li>
<li><a class="reference internal" href="#py3in2outputchecker">Py3In2OutputChecker</a></li>
</ul>
</li>
</ul>

<h3><a href="../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../about/index.html">About Music21</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../usersGuide/index.html">User&#8217;s Guide</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Module Reference</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installing/index.html">Installation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developerReference/index.html">Developer Reference</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/moduleReference/moduleTestTestRunner.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="music21-test-testrunner">
<span id="moduletesttestrunner"></span><h1>music21.test.testRunner<a class="headerlink" href="#music21-test-testrunner" title="Permalink to this headline">¶</a></h1>
<span class="target" id="module-music21.test.testRunner"></span><p>The testRunner module contains the all important &#8220;mainTest&#8221; function that runs tests
in a given module.  Except for the one instance of &#8220;defaultImports&#8221;, everything here
can run on any system, not just music21.</p>
<div class="section" id="functions">
<h2>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="music21.test.testRunner.addDocAttrTestsToSuite">
<code class="descclassname">music21.test.testRunner.</code><code class="descname">addDocAttrTestsToSuite</code><span class="sig-paren">(</span><em>suite</em>, <em>moduleVariableLists</em>, <em>outerFilename=None</em>, <em>globs=False</em>, <em>optionflags=12</em><span class="sig-paren">)</span><a class="headerlink" href="#music21.test.testRunner.addDocAttrTestsToSuite" title="Permalink to this definition">¶</a></dt>
<dd><p>takes a suite, such as a doctest.DocTestSuite and the list of variables
in a module and adds from those classes that have a _DOC_ATTR dictionary
(which documents the properties in the class) any doctests to the suite.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">doctest</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span> <span class="o">=</span> <span class="n">doctest</span><span class="o">.</span><span class="n">DocTestSuite</span><span class="p">(</span><span class="n">chord</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s1TestsBefore</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s1</span><span class="o">.</span><span class="n">_tests</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">allLocals</span> <span class="o">=</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">chord</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">chord</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">test</span><span class="o">.</span><span class="n">testRunner</span><span class="o">.</span><span class="n">addDocAttrTestsToSuite</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">allLocals</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s1TestsAfter</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s1</span><span class="o">.</span><span class="n">_tests</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s1TestsAfter</span> <span class="o">-</span> <span class="n">s1TestsBefore</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">s1</span><span class="o">.</span><span class="n">_tests</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span>
<span class="go">isRest ()</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;hi&#39;</span>
<span class="go">&#39;hi&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="music21.test.testRunner.fixTestsForPy2and3">
<code class="descclassname">music21.test.testRunner.</code><code class="descname">fixTestsForPy2and3</code><span class="sig-paren">(</span><em>doctestSuite</em><span class="sig-paren">)</span><a class="headerlink" href="#music21.test.testRunner.fixTestsForPy2and3" title="Permalink to this definition">¶</a></dt>
<dd><p>Fix doctests so that they work in both python2 and python3, namely
unicode/byte characters and added module names to exceptions.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">doctest</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">suite1</span> <span class="o">=</span> <span class="n">doctest</span><span class="o">.</span><span class="n">DocTestSuite</span><span class="p">(</span><span class="n">chord</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doctestCase</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">suite1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dt</span> <span class="o">=</span> <span class="n">doctestCase</span><span class="o">.</span><span class="n">_dt_test</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">testWithTraceback</span> <span class="o">=</span> <span class="kc">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">testExample</span> <span class="ow">in</span> <span class="n">dt</span><span class="o">.</span><span class="n">examples</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="n">testExample</span><span class="o">.</span><span class="n">exc_msg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="gp">... </span>        <span class="n">testWithTraceback</span> <span class="o">=</span> <span class="n">testExample</span>
<span class="gp">... </span>        <span class="k">break</span>
</pre></div>
</div>
<p>Py3 example:</p>
<p>&lt;&lt;&lt; testWithTraceback.exc_msg
&#8220;ChordException: Could not process input argumentn&#8221;
&lt;&lt;&lt; test.testRunner.fixTestsForPy2and3(suite1)
&lt;&lt;&lt; testWithTraceback.exc_msg
&#8221;...ChordException: Could not process input argumentn&#8221;</p>
<p>Py2 example:</p>
<p>&lt;&lt;&lt; testWithTraceback.exc_msg
&#8220;music21.chord.ChordException: Could not process input argumentn&#8221;
&lt;&lt;&lt; test.testRunner.fixTestsForPy2and3(suite1)
&lt;&lt;&lt; testWithTraceback.exc_msg
&#8220;ChordException: Could not process input argumentn&#8221;</p>
</dd></dl>

<dl class="function">
<dt id="music21.test.testRunner.mainTest">
<code class="descclassname">music21.test.testRunner.</code><code class="descname">mainTest</code><span class="sig-paren">(</span><em>*testClasses</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#music21.test.testRunner.mainTest" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes as its arguments modules (or a string &#8216;noDocTest&#8217; or &#8216;verbose&#8217;)
and runs all of these modules through a unittest suite</p>
<p>Unless &#8216;noDocTest&#8217; is passed as a module, a docTest
is also performed on <cite>__main__</cite>, hence the name &#8220;mainTest&#8221;.</p>
<p>If &#8216;moduleRelative&#8217; (a string) is passed as a module, then
global variables are preserved.</p>
<p>Run example (put at end of your modules):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">unittest</span>
<span class="k">class</span> <span class="nc">Test</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">testHello</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">hello</span> <span class="o">=</span> <span class="s2">&quot;Hello&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s2">&quot;Hello&quot;</span><span class="p">,</span> <span class="n">hello</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">music21</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">music21</span><span class="o">.</span><span class="n">mainTest</span><span class="p">(</span><span class="n">Test</span><span class="p">)</span>
</pre></div>
</div>
<p>This module tries to fix up some differences between python2 and python3 so
that the same doctests can work.</p>
</dd></dl>

<dl class="function">
<dt id="music21.test.testRunner.stripAddresses">
<code class="descclassname">music21.test.testRunner.</code><code class="descname">stripAddresses</code><span class="sig-paren">(</span><em>textString</em>, <em>replacement='ADDRESS'</em><span class="sig-paren">)</span><a class="headerlink" href="#music21.test.testRunner.stripAddresses" title="Permalink to this definition">¶</a></dt>
<dd><p>Function that changes all memory addresses (pointers) in the given
textString with (replacement).  This is useful for testing
that a function gives an expected result even if the result
contains references to memory locations.  So for instance:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">test</span><span class="o">.</span><span class="n">testRunner</span><span class="o">.</span><span class="n">stripAddresses</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0.0}</span><span class="s2"> &lt;music21.clef.TrebleClef object at 0x02A87AD0&gt;&quot;</span><span class="p">)</span>
<span class="go">&#39;{0.0} &lt;music21.clef.TrebleClef object at ADDRESS&gt;&#39;</span>
</pre></div>
</div>
<p>while this is left alone:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">test</span><span class="o">.</span><span class="n">testRunner</span><span class="o">.</span><span class="n">stripAddresses</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0.0}</span><span class="s2"> &lt;music21.humdrum.MiscTandem *&gt;I humdrum control&gt;&quot;</span><span class="p">)</span>
<span class="go">&#39;{0.0} &lt;music21.humdrum.MiscTandem *&gt;I humdrum control&gt;&#39;</span>
</pre></div>
</div>
<p>For doctests, can strip to &#8216;...&#8217; to make it work fine with doctest.ELLIPSIS</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">test</span><span class="o">.</span><span class="n">testRunner</span><span class="o">.</span><span class="n">stripAddresses</span><span class="p">(</span>
<span class="gp">... </span>    <span class="s2">&quot;</span><span class="si">{0.0}</span><span class="s2"> &lt;music21.base.Music21Object object at 0x102a0ff10&gt;&quot;</span><span class="p">,</span> <span class="s1">&#39;0x...&#39;</span><span class="p">)</span>
<span class="go">&#39;{0.0} &lt;music21.base.Music21Object object at 0x...&gt;&#39;</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">str</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="py3in2outputchecker">
<h2>Py3In2OutputChecker<a class="headerlink" href="#py3in2outputchecker" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="music21.test.testRunner.Py3In2OutputChecker">
<em class="property">class </em><code class="descclassname">music21.test.testRunner.</code><code class="descname">Py3In2OutputChecker</code><a class="headerlink" href="#music21.test.testRunner.Py3In2OutputChecker" title="Permalink to this definition">¶</a></dt>
<dd><p>In music21, we write all doctests for passing
under Python 3.  The differences between it and
Py2 mean that we need to find certain differences
and remove them.</p>
<p>First version: removes bytes from the expected output (want) and unicode from received (got)</p>
</dd></dl>

<p class="rubric"><a class="reference internal" href="#music21.test.testRunner.Py3In2OutputChecker" title="music21.test.testRunner.Py3In2OutputChecker"><code class="xref py py-class docutils literal"><span class="pre">Py3In2OutputChecker</span></code></a> methods</p>
<dl class="method">
<dt id="music21.test.testRunner.Py3In2OutputChecker.check_output">
<code class="descclassname">Py3In2OutputChecker.</code><code class="descname">check_output</code><span class="sig-paren">(</span><em>want</em>, <em>got</em>, <em>optionflags</em><span class="sig-paren">)</span><a class="headerlink" href="#music21.test.testRunner.Py3In2OutputChecker.check_output" title="Permalink to this definition">¶</a></dt>
<dd><p>cannot use super with Py2 since we have old-style classes going on.</p>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="moduleTestTestSingleCoreAll.html" title="music21.test.testSingleCoreAll"
             >next</a> |</li>
        <li class="right" >
          <a href="moduleTestTestLint.html" title="music21.test.testLint"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">music21</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Module Reference</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2006-2016, Michael Scott Cuthbert and cuthbertLab.
      Last updated on Aug 21, 2016.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.4.1.
    </div>
  </body>
</html>