<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>User’s Guide, Chapter 23: Advanced Corpus and Metadata Searching &mdash; music21 Documentation</title>
    
    <link rel="stylesheet" href="../_static/m21.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <link rel="top" title="music21 Documentation" href="../index.html" />
    <link rel="up" title="User’s Guide" href="index.html" />
    <link rel="next" title="User’s Guide, Chapter 25: Post-Tonal Tools (1)" href="usersGuide_25_postTonalTools1.html" />
    <link rel="prev" title="User’s Guide, Chapter 22: Graphing" href="usersGuide_22_graphing.html" /><link href='http://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:300italic,400italic,700italic,400,300,700' rel='stylesheet' type='text/css'>
<script src='http://artusi.xyz/music21j/ext/require/require.js'></script>
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="usersGuide_25_postTonalTools1.html" title="User’s Guide, Chapter 25: Post-Tonal Tools (1)"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="usersGuide_22_graphing.html" title="User’s Guide, Chapter 22: Graphing"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">music21</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">User&#8217;s Guide</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="usersGuide_22_graphing.html"
                        title="previous chapter">User’s Guide, Chapter 22: Graphing</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="usersGuide_25_postTonalTools1.html"
                        title="next chapter">User&#8217;s Guide, Chapter 25: Post-Tonal Tools (1)</a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">User&#8217;s Guide, Chapter 23: Advanced Corpus and Metadata Searching</a><ul>
<li><a class="reference internal" href="#creating-multiple-corpus-repositories-via-local-corpora">Creating multiple corpus repositories via local corpora</a></li>
<li><a class="reference internal" href="#inspecting-metadata-bundle-search-results">Inspecting metadata bundle search results</a></li>
<li><a class="reference internal" href="#manipulating-multiple-metadata-bundles">Manipulating multiple metadata bundles</a></li>
<li><a class="reference internal" href="#getting-a-metadata-bundle">Getting a metadata bundle</a></li>
<li><a class="reference internal" href="#creating-persistent-metadata-bundles">Creating persistent metadata bundles</a></li>
</ul>
</li>
</ul>

<h3><a href="../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../about/index.html">About Music21</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User&#8217;s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="usersGuide_99_Table_of_Contents.html">User&#8217;s Guide: Table of Contents</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_01_installing.html">User&#8217;s Guide, Chapter 1: Installing and Getting Started with <code class="docutils literal"><span class="pre">music21</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_02_notes.html">User&#8217;s Guide, Chapter 2: Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_03_pitches.html">User&#8217;s Guide, Chapter 3: Pitches, Durations, and Notes again</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_04_stream1.html">User&#8217;s Guide, Chapter 4: Lists, Streams (I) and Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_05_listsOfLists.html">User&#8217;s Guide, Chapter 5: Lists of Lists, Functions, and Recursion</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_06_stream2.html">User&#8217;s Guide, Chapter 6: Streams (II): Hierarchies, Recursion, and Flattening</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_07_chords.html">User&#8217;s Guide, Chapter 7: Chords</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_08_installingMusicXML.html">User&#8217;s Guide, Chapter 8: Installing MusicXML Readers and File Formats (1)</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_09_chordify.html">User&#8217;s Guide, Chapter 9: Chordify</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_10_examples1.html">User&#8217;s Guide, Chapter 10: Examples 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_11_corpusSearching.html">User&#8217;s Guide, Chapter 11: Corpus Searching</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_12_music21object.html">User&#8217;s Guide, Chapter 12: Getting Back to Basics: The Music21Object</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_13_music21object2.html">User&#8217;s Guide, Chapter 13: More Music21Object Attributes and Properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_14_timeSignatures.html">User&#8217;s Guide: Chapter 14: Time Signatures and Beats</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_15_key.html">User&#8217;s Guide, Chapter 15: Keys and KeySignatures</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_17_derivations.html">User&#8217;s Guide: Chapter 17: Derivations</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_21_sorting.html">User&#8217;s Guide, Chapter 21: Ordering and Sorting of Stream Elements</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_22_graphing.html">User’s Guide, Chapter 22: Graphing</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">User&#8217;s Guide, Chapter 23: Advanced Corpus and Metadata Searching</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_25_postTonalTools1.html">User&#8217;s Guide, Chapter 25: Post-Tonal Tools (1)</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_26_clientWeakref.html">User&#8217;s Guide, Chapter 26: Clients and Weak References.</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_27_graceNotes.html">User&#8217;s Guide, Chapter 27: Grace Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_28_lyricSearcher.html">User&#8217;s Guide, Chapter 28: Lyric Searching</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_54_extendingConverter.html">User&#8217;s Guide, Chapter 54: Extending Converter with New Formats</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_55_advancedMeter.html">User&#8217;s Guide, Chapter 55: Advanced Meter Topics</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_90_musicxmlTest.html">User&#8217;s Guide, Chapter 90: Lilypond Unofficial MusicXML Test Suite</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_97_timespans.html">Timespan Demos</a></li>
<li class="toctree-l2"><a class="reference internal" href="usersGuide_98_inversionDemo.html">Inversion Demo</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../moduleReference/index.html">Module Reference</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installing/index.html">Installation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developerReference/index.html">Developer Reference</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/usersGuide/usersGuide_23_advancedCorpus.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <span class="target" id="usersguide-23-advancedcorpus"></span><div class="section" id="user-s-guide-chapter-23-advanced-corpus-and-metadata-searching">
<h1>User&#8217;s Guide, Chapter 23: Advanced Corpus and Metadata Searching<a class="headerlink" href="#user-s-guide-chapter-23-advanced-corpus-and-metadata-searching" title="Permalink to this headline">¶</a></h1>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">music21</span> <span class="k">import</span> <span class="o">*</span>
</pre></div>
</div>
<div class="section" id="creating-multiple-corpus-repositories-via-local-corpora">
<h2>Creating multiple corpus repositories via local corpora<a class="headerlink" href="#creating-multiple-corpus-repositories-via-local-corpora" title="Permalink to this headline">¶</a></h2>
<p>In addition to the default local corpus, music21 allows users to create
and save as many named local corpora as they like, which will persist
from session to session.</p>
<p>Let&#8217;s create a new <em>local</em> corpus, give it a directory to find music
files in, and then save it:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">aNewLocalCorpus</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">corpora</span><span class="o">.</span><span class="n">LocalCorpus</span><span class="p">(</span><span class="s1">&#39;A new corpus&#39;</span><span class="p">)</span>
<span class="n">aNewLocalCorpus</span><span class="o">.</span><span class="n">existsInSettings</span>
</pre></div>
</div>
<div class="ipython-result highlight-default"><div class="highlight"><pre><span></span> <span class="kc">False</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">aNewLocalCorpus</span><span class="o">.</span><span class="n">addPath</span><span class="p">(</span><span class="s1">&#39;~/Desktop&#39;</span><span class="p">)</span>
<span class="n">aNewLocalCorpus</span><span class="o">.</span><span class="n">directoryPaths</span>
</pre></div>
</div>
<div class="ipython-result highlight-default"><div class="highlight"><pre><span></span> <span class="p">(</span><span class="s1">&#39;/Users/josiah/Desktop&#39;</span><span class="p">,)</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">aNewLocalCorpus</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="n">aNewLocalCorpus</span><span class="o">.</span><span class="n">existsInSettings</span>
</pre></div>
</div>
<div class="ipython-result highlight-default"><div class="highlight"><pre><span></span> <span class="kc">True</span>
</pre></div>
</div>
<p>We can see that our new <em>local</em> corpus is saved by checking for the
names of all saved <em>local</em> corpora using the corpus.manager list:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">corpus</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">listLocalCorporaNames</span><span class="p">()</span>
</pre></div>
</div>
<div class="ipython-result highlight-default"><div class="highlight"><pre><span></span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;trecento&#39;</span><span class="p">,</span> <span class="s1">&#39;A new corpus&#39;</span><span class="p">,</span> <span class="s1">&#39;bach&#39;</span><span class="p">,</span> <span class="s1">&#39;fake&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>When running <code class="docutils literal"><span class="pre">listLocalCorporaNames()</span></code>, you will see <code class="docutils literal"><span class="pre">None</span></code> -
indicating the default <em>local</em> corpus - along with the names of any
non-default <em>local</em> corpora you&#8217;ve manually created yourself. In the above
example, a number of other corpora have already been created.</p>
<p class="last">In Python2, take care to make all of these &#8220;unicode&#8221; entries.</p>
</div>
<p>Finally, we can delete the <em>local</em> corpus we previously created like
this:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">aNewLocalCorpus</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
<span class="n">aNewLocalCorpus</span><span class="o">.</span><span class="n">existsInSettings</span>
</pre></div>
</div>
<div class="ipython-result highlight-default"><div class="highlight"><pre><span></span> <span class="kc">False</span>
</pre></div>
</div>
</div>
<div class="section" id="inspecting-metadata-bundle-search-results">
<h2>Inspecting metadata bundle search results<a class="headerlink" href="#inspecting-metadata-bundle-search-results" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s take a closer look at some search results:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">bachBundle</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">corpora</span><span class="o">.</span><span class="n">CoreCorpus</span><span class="p">()</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;bach&#39;</span><span class="p">,</span> <span class="s1">&#39;composer&#39;</span><span class="p">)</span>
<span class="n">bachBundle</span>
</pre></div>
</div>
<div class="ipython-result highlight-default"><div class="highlight"><pre><span></span> <span class="o">&lt;</span><span class="n">music21</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">bundles</span><span class="o">.</span><span class="n">MetadataBundle</span> <span class="p">{</span><span class="mi">22</span> <span class="n">entries</span><span class="p">}</span><span class="o">&gt;</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">bachBundle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<div class="ipython-result highlight-default"><div class="highlight"><pre><span></span> <span class="o">&lt;</span><span class="n">music21</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">bundles</span><span class="o">.</span><span class="n">MetadataEntry</span><span class="p">:</span> <span class="n">bach_choraleAnalyses_riemenschneider001_rntxt</span><span class="o">&gt;</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">bachBundle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sourcePath</span>
</pre></div>
</div>
<div class="ipython-result highlight-default"><div class="highlight"><pre><span></span> <span class="s1">&#39;bach/choraleAnalyses/riemenschneider001.rntxt&#39;</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">bachBundle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">metadataPayload</span>
</pre></div>
</div>
<div class="ipython-result highlight-default"><div class="highlight"><pre><span></span> <span class="o">&lt;</span><span class="n">music21</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">RichMetadata</span> <span class="n">at</span> <span class="mh">0x115807710</span><span class="o">&gt;</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">mdpl</span> <span class="o">=</span> <span class="n">bachBundle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">metadataPayload</span>
<span class="n">mdpl</span><span class="o">.</span><span class="n">noteCount</span>
</pre></div>
</div>
<div class="ipython-result highlight-default"><div class="highlight"><pre><span></span> <span class="mi">60</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">bachAnalysis0</span> <span class="o">=</span> <span class="n">bachBundle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">parse</span><span class="p">()</span>
<span class="n">bachAnalysis0</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/usersGuide_23_advancedCorpus_18_0.png" src="../_images/usersGuide_23_advancedCorpus_18_0.png" />
</div>
<div class="section" id="manipulating-multiple-metadata-bundles">
<h2>Manipulating multiple metadata bundles<a class="headerlink" href="#manipulating-multiple-metadata-bundles" title="Permalink to this headline">¶</a></h2>
<p>Another useful feature of <code class="docutils literal"><span class="pre">music21</span></code>&#8216;s metadata bundles is that they
can be operated on as though they were sets, allowing you to union,
intersect and difference multiple metadata bundles, thereby creating
more complex search results:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">corelliBundle</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;corelli&#39;</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">&#39;composer&#39;</span><span class="p">)</span>
<span class="n">corelliBundle</span>
</pre></div>
</div>
<div class="ipython-result highlight-default"><div class="highlight"><pre><span></span> <span class="o">&lt;</span><span class="n">music21</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">bundles</span><span class="o">.</span><span class="n">MetadataBundle</span> <span class="p">{</span><span class="mi">1</span> <span class="n">entry</span><span class="p">}</span><span class="o">&gt;</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">bachBundle</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">corelliBundle</span><span class="p">)</span>
</pre></div>
</div>
<div class="ipython-result highlight-default"><div class="highlight"><pre><span></span> <span class="o">&lt;</span><span class="n">music21</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">bundles</span><span class="o">.</span><span class="n">MetadataBundle</span> <span class="p">{</span><span class="mi">23</span> <span class="n">entries</span><span class="p">}</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Consult the API for class:<code class="docutils literal"><span class="pre">~music21.metadata.bundles.MetadataBundle</span></code>
for a more in depth look at how this works.</p>
</div>
<div class="section" id="getting-a-metadata-bundle">
<h2>Getting a metadata bundle<a class="headerlink" href="#getting-a-metadata-bundle" title="Permalink to this headline">¶</a></h2>
<p>In music21, metadata is information <em>about</em> a score, such as its
composer, title, initial key signature or ambitus. A metadata <em>bundle</em>
is a collection of metadata pulled from an arbitrarily large group of
different scores. Users can search through metadata bundles to find
scores with certain qualities, such as all scores in a given corpus with
a time signature of <code class="docutils literal"><span class="pre">6/8</span></code>, or all scores composed by Monteverdi.</p>
<p>There are a number of different ways to acquire a metadata bundle. The
easiest way to get the metadataBundle for the core corpus is simply to
download music21: we include a pre-made metadataBundle (in
<code class="docutils literal"><span class="pre">corpus/metadataCache/core.json</span></code>) so that this step is unnecessary for
the core corpus unless you&#8217;re contributing to the project. But you may
want to create metadata bundles for your own local corpora. Access the
<code class="docutils literal"><span class="pre">metadataBundle</span></code> attribute of any <code class="docutils literal"><span class="pre">Corpus</span></code> instance to get its
corresponding metadata bundle:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">coreCorpus</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">corpora</span><span class="o">.</span><span class="n">CoreCorpus</span><span class="p">()</span>
<span class="n">coreCorpus</span><span class="o">.</span><span class="n">metadataBundle</span>
</pre></div>
</div>
<div class="ipython-result highlight-default"><div class="highlight"><pre><span></span> <span class="o">&lt;</span><span class="n">music21</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">bundles</span><span class="o">.</span><span class="n">MetadataBundle</span> <span class="s1">&#39;core&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">14486</span> <span class="n">entries</span><span class="p">}</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Music21 also provides a handful of convenience methods for getting
metadata bundles associated with the <em>virtual</em>, <em>local</em> or <em>core</em>
corpora:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">coreBundle</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">corpora</span><span class="o">.</span><span class="n">CoreCorpus</span><span class="p">()</span><span class="o">.</span><span class="n">metadataBundle</span>
<span class="n">localBundle</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">corpora</span><span class="o">.</span><span class="n">LocalCorpus</span><span class="p">()</span><span class="o">.</span><span class="n">metadataBundle</span>
<span class="n">otherLocalBundle</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">corpora</span><span class="o">.</span><span class="n">LocalCorpus</span><span class="p">(</span><span class="s1">&#39;blah&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">metadataBundle</span>
<span class="n">virtualBundle</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">corpora</span><span class="o">.</span><span class="n">VirtualCorpus</span><span class="p">()</span><span class="o">.</span><span class="n">metadataBundle</span>
</pre></div>
</div>
<p>But really advanced users can also make metadata bundles manually, by
passing in the name of the corpus you want the bundle to refer to, or,
equivalently, an actual <code class="docutils literal"><span class="pre">Corpus</span></code> instance itself:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">coreBundle</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">bundles</span><span class="o">.</span><span class="n">MetadataBundle</span><span class="p">(</span><span class="s1">&#39;core&#39;</span><span class="p">)</span>
<span class="n">coreBundle</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">bundles</span><span class="o">.</span><span class="n">MetadataBundle</span><span class="p">(</span><span class="n">corpus</span><span class="o">.</span><span class="n">corpora</span><span class="o">.</span><span class="n">CoreCorpus</span><span class="p">())</span>
</pre></div>
</div>
<p>However, you&#8217;ll need to read the bundle&#8217;s saved data from disk before
you can do anything useful with the bundle. Bundles don&#8217;t read their
associated JSON files automatically when they&#8217;re manually instantiated.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">coreBundle</span>
</pre></div>
</div>
<div class="ipython-result highlight-default"><div class="highlight"><pre><span></span> <span class="o">&lt;</span><span class="n">music21</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">bundles</span><span class="o">.</span><span class="n">MetadataBundle</span> <span class="s1">&#39;core&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span> <span class="n">entries</span><span class="p">}</span><span class="o">&gt;</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">coreBundle</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
<div class="ipython-result highlight-default"><div class="highlight"><pre><span></span> <span class="o">&lt;</span><span class="n">music21</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">bundles</span><span class="o">.</span><span class="n">MetadataBundle</span> <span class="s1">&#39;core&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">14486</span> <span class="n">entries</span><span class="p">}</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-persistent-metadata-bundles">
<h2>Creating persistent metadata bundles<a class="headerlink" href="#creating-persistent-metadata-bundles" title="Permalink to this headline">¶</a></h2>
<p>Metadata bundles can take a long time to create. So it&#8217;d be nice if they
could be written to and read from disk. Unfortunately we never got
around to...nah, just kidding. Of course you can. Just call <code class="docutils literal"><span class="pre">.write()</span></code>
on one:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">coreBundle</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">bundles</span><span class="o">.</span><span class="n">MetadataBundle</span><span class="p">(</span><span class="s1">&#39;core&#39;</span><span class="p">)</span>
<span class="n">coreBundle</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
<div class="ipython-result highlight-default"><div class="highlight"><pre><span></span> <span class="o">&lt;</span><span class="n">music21</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">bundles</span><span class="o">.</span><span class="n">MetadataBundle</span> <span class="s1">&#39;core&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">14486</span> <span class="n">entries</span><span class="p">}</span><span class="o">&gt;</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">coreBundle</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>
</pre></div>
</div>
<p>They can also be completely rebuilt, as you will want to do for local
corpora. To add information to a bundle, use the <code class="docutils literal"><span class="pre">addFromPaths()</span></code>
method:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">newBundle</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">bundles</span><span class="o">.</span><span class="n">MetadataBundle</span><span class="p">()</span>
<span class="n">paths</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">corpora</span><span class="o">.</span><span class="n">CoreCorpus</span><span class="p">()</span><span class="o">.</span><span class="n">getBachChorales</span><span class="p">()</span>
<span class="n">failedPaths</span> <span class="o">=</span> <span class="n">newBundle</span><span class="o">.</span><span class="n">addFromPaths</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span>
<span class="n">failedPaths</span>
</pre></div>
</div>
<div class="ipython-result highlight-default"><div class="highlight"><pre><span></span> <span class="p">[]</span>
</pre></div>
</div>
<p>then call <code class="docutils literal"><span class="pre">.write()</span></code> to save to disk</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">newBundle</span>
</pre></div>
</div>
<div class="ipython-result highlight-default"><div class="highlight"><pre><span></span> <span class="o">&lt;</span><span class="n">music21</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">bundles</span><span class="o">.</span><span class="n">MetadataBundle</span> <span class="p">{</span><span class="mi">402</span> <span class="n">entries</span><span class="p">}</span><span class="o">&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Building metadata information can be an incredibly intensive process. For
example, building the <em>core</em> metadata bundle can easily take as long as four
hours! And this is even though the building process uses multiple cores.
Please use caution, and be patient, when building metadata bundles
from large corpora. To monitor the corpus-building progress, make sure to
set &#8216;debug&#8217; to True in your user settings:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">environment</span><span class="o">.</span><span class="n">UserSettings</span><span class="p">()[</span><span class="s1">&#39;debug&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
<p>You can delete, rebuild and save a metadata bundle in one go with the
<code class="docutils literal"><span class="pre">rebuild()</span></code> method:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">virtualBundle</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">corpora</span><span class="o">.</span><span class="n">VirtualCorpus</span><span class="p">()</span><span class="o">.</span><span class="n">metadataBundle</span>
<span class="n">virtualBundle</span><span class="o">.</span><span class="n">rebuild</span><span class="p">()</span>
</pre></div>
</div>
<p>The process of rebuilding will store the file as it goes (for safety) so
at the end there is no need to call <code class="docutils literal"><span class="pre">.write()</span></code>.</p>
<p>To delete a metadata bundle&#8217;s cached-to-disk JSON file, use the
<code class="docutils literal"><span class="pre">delete()</span></code> method:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">virtualBundle</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</pre></div>
</div>
<p>Deleting a metadata bundle&#8217;s JSON file won&#8217;t empty the in-memory
contents of that bundle. For that, use <code class="docutils literal"><span class="pre">clear()</span></code>:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">virtualBundle</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="usersGuide_25_postTonalTools1.html" title="User’s Guide, Chapter 25: Post-Tonal Tools (1)"
             >next</a> |</li>
        <li class="right" >
          <a href="usersGuide_22_graphing.html" title="User’s Guide, Chapter 22: Graphing"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">music21</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >User&#8217;s Guide</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2006-2016, Michael Scott Cuthbert and cuthbertLab.
      Last updated on Aug 21, 2016.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.4.1.
    </div>
  </body>
</html>